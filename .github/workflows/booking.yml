name: Booking Checker

on:
  schedule:
    - cron: "0 0 * * *"   # å°åŒ— 08:00
    - cron: "0 4 * * *"   # å°åŒ— 12:00
    - cron: "0 9 * * *"   # å°åŒ— 17:00
  workflow_dispatch:      # å¯æ‰‹å‹•è§¸ç™¼

jobs:
  run_booking:
    runs-on: ubuntu-latest

    steps:
      # ----------------------------------------------------
      # 1. Checkout
      # ----------------------------------------------------
      - name: Checkout code
        uses: actions/checkout@v4

      # ----------------------------------------------------
      # 2. Setup Python
      # ----------------------------------------------------
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"     # pip å¿«å–ï¼ŒåŠ é€Ÿ

      # ----------------------------------------------------
      # 3. Install dependencies
      # ----------------------------------------------------
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install chromium

      # ----------------------------------------------------
      # 4. Create Google credentials files (SAFE)
      # ----------------------------------------------------
      - name: Create Google Service Account file
        run: |
          printf "%s" "${{ secrets.GOOGLE_SERVICE_ACCOUNT }}" > service_account.json
          printf "%s" "${{ secrets.SPREADSHEET_ID }}" > spreadsheet_id

      # ----------------------------------------------------
      # 5. Run script
      # ----------------------------------------------------
      - name: Run booking checker
        run: |
          python booking_checker_playwright_cloud.py

      # ----------------------------------------------------
      # 6. å¦‚æœå‡ºéŒ¯ï¼Œé¡¯ç¤ºæ›´å¤šè³‡è¨Šï¼ˆé¿å…é›£ debugï¼‰
      # ----------------------------------------------------
      - name: Show service_account.json if failed (å®‰å…¨ç„¡æ•æ„Ÿè³‡è¨Šæ¢ä»¶)
        if: failure()
        run: |
          echo "ğŸ” Debug: service_account.json ç¬¬ä¸€è¡Œå…§å®¹ï¼š"
          head -n 1 service_account.json || true

